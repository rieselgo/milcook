# プロダクトビジョンとPRD - 粉ミルク調乳タイマー

## プロダクトビジョン

**「科学的根拠に基づき、育児中の親をサポートする、最も正確で使いやすい調乳タイマー」**

---

## エグゼクティブサマリー

### 解決する課題
1. **待ち時間の不確実性**: 調乳後、いつ適温になるか分からず赤ちゃんを泣かせてしまう
2. **温度管理の難しさ**: 熱すぎても冷めすぎても授乳できない
3. **材質・方法による差**: 哺乳瓶の材質や冷却方法で時間が大きく異なるが予測困難

### ソリューション
熱力学計算に基づいた**科学的に正確な温度予測タイマー**
- ニュートンの冷却法則を用いた正確な温度計算
- 材質別（ガラス/プラスチック/PPSU）のパラメータ対応
- 5つの冷却方法の最適化提案

### ターゲットユーザー
- **プライマリ**: 0-12ヶ月の赤ちゃんを持つ親（特に夜間授乳をしている）
- **セカンダリ**: 科学的根拠に基づいた育児を志向する保護者

---

## Phase 1: MVP（最小機能製品） ✅ 完了

**目標**: 基本的な調乳タイマー機能を提供

### 実装済み機能

#### 1.1 初期設定 ✅
- [x] ミルク量選択: 60ml〜240ml（20ml刻み、スライダー）
- [x] 哺乳瓶材質選択: ガラス / プラスチック / PPSU
- [x] 目標温度設定: 35°C〜42°C（スライダー調整）
- [x] 冷却方法選択: 4つの方法（氷水攪拌/氷水静置/水道水静置/常温放置）

**実装詳細**:
- 設定は localStorage に保存 ✅
- 前回の設定を記憶してクイックスタート可能 ✅
- デフォルト値: 140ml, ガラス, 38°C ✅

**実装の変更点**:
- ユーザー入力ベースに変更（お湯と湯冷ましの量・温度を実際の値で入力）
- より実用的で柔軟な設計

#### 1.2 調乳ガイド ✅
- [x] 準備チェックリスト（哺乳瓶・粉ミルク・お湯・湯冷まし・ボウル）
- [x] ユーザー入力画面（お湯の温度・量、湯冷ましの温度・量）
- [x] 混合後の温度をリアルタイム表示
- [x] 予測冷却時間をリアルタイム表示
- [x] 粉ミルク溶解確認チェック

**実装の変更点**:
- 計算ベース → ユーザー入力ベースに変更（実際の使用状況に合わせる）

#### 1.3 冷却方法 ✅
4つの冷却方法を実装:

1. **氷水攪拌** ⭐推奨
   - 現在の予測: 約3分（ガラス瓶、140ml、62°C→38°C）
   - 実装済み

2. **氷水静置**
   - 現在の予測: 約10分
   - 実装済み

3. **水道水静置**
   - 現在の予測: 約15分
   - 実装済み

4. **常温放置**
   - 現在の予測: 約60分
   - 実装済み

**実装の変更点**:
- 流水冷却/氷水+流水は削除（水の無駄、実用性低い）
- より実用的な4つの方法に絞り込み

#### 1.4 タイマー実行画面 ✅
- [x] 経過時間表示
- [x] 現在温度表示（リアルタイム計算、1秒更新）
- [x] 目標温度表示
- [x] 進捗バー
- [x] **一時停止/再開ボタン** ⭐新規追加
- [x] **終了ボタン（ホーム画面に戻る）** ⭐新規追加

**熱力学計算** ✅:
```typescript
// ニュートンの冷却法則
T(t) = T_ambient + (T_initial - T_ambient) * exp(-k * t)

// k: 冷却定数（材質・方法による）
// t: 経過時間（分）
```

#### 1.5 適温アラート ✅
- [x] バイブレーション（200ms-100ms-200ms-100ms-200msパターン）
- [x] 音声通知（800Hzビープ音）
- [x] ブラウザ通知（Notification API）
- [x] 通知設定の永続化（LocalStorage）

### 成功指標（MVP）
- ⚠️ **タイマー予測精度**: 要検証（現在、体感との乖離あり）
- ✅ 完了率: 一時停止・再開・終了機能で改善
- ✅ 初回起動から調乳開始まで: 30秒以内で可能

---

## Phase 2: ビジュアル強化 ✅ 完了

**目標**: ユーザー体験を向上させる視覚的フィードバック

### 実装済み機能

#### 2.1 哺乳瓶SVGアニメーション ✅
- [x] SVGベースの哺乳瓶イラスト
- [x] 温度に応じた色変化（グラデーション）
  - 50°C以上: 濃いオレンジ (#FF6B35)
  - 45-50°C: オレンジ (#FF8C42)
  - 40-45°C: 薄いオレンジ (#FFB84D)
  - 38-40°C: イエロー (#FFF066)
  - 38°C以下: グリーン (#4CAF50)
- [x] スムーズなトランジション（1秒ごと）
- [x] 液面の波のアニメーション（2つの波を重ねた効果）
- [x] ミルク量に応じた液面の高さ調整
- [x] 温度インジケーターバー

#### 2.2 温度グラフ ✅
- [x] 時間（横軸）× 温度（縦軸）のリアルタイムグラフ
- [x] 予測曲線の表示
- [x] 現在位置のマーカー
- [x] 目標温度ライン（破線）
- [x] グリッド線とラベル

**実装の変更点**:
- Chart.js不使用 → SVGで軽量実装

#### 2.3 進捗バー・冷却速度メーター ✅
- [x] 目標温度までの進捗（パーセント表示）
- [x] スムーズなアニメーション
- [x] 冷却速度（°C/分）のリアルタイム表示
- [x] 2カラムレイアウト（残り時間 + 冷却速度）

#### 2.4 ダークモード対応 ✅
- [x] システム設定に応じた自動切り替え
- [x] 手動切り替えオプション（☀️/🌙/🔄ボタン）
- [x] LocalStorageで設定を永続化
- [x] 全コンポーネントのダークモード対応

### 成功指標
- ✅ ユーザー体験の向上
- ✅ 視覚的フィードバックの充実

---

## Phase 3: 氷水攪拌モード特化 ⏭️ スキップ

**判断理由**:
- 実際のユースケースでは氷水静置（放置）が主流
- 攪拌モードの需要が低い
- Phase 4, 5を優先して実装

---

## Phase 4: 履歴・学習機能 ✅ 完了

**目標**: 使うほど精度が向上

### 実装済み機能

#### 4.1 履歴保存（LocalStorage） ✅
- [x] 調乳セッションの記録
  - 日時
  - ミルク量
  - 材質
  - 冷却方法
  - 予測時間 vs 実測時間
  - 初期温度・目標温度
- [x] LocalStorageで永続化

**実装の変更点**:
- IndexedDB → LocalStorageに変更（シンプル化）

#### 4.2 統計画面 ✅
- [x] 総回数
- [x] 平均ミルク量
- [x] 平均時間
- [x] 今日の調乳回数・量

#### 4.3 実測値との比較 ✅
- [x] 履歴モーダルで予測時間 vs 実測時間を表示
- [x] 最近10件のセッション一覧

#### 4.4 環境補正機能 ⚠️ 未実装
- [ ] 実測データから環境係数を学習
- [ ] 冷却定数の自動調整（±10%範囲内）
- [ ] 3回以上の実測で補正開始

**実装判断**:
- まずは実測データを収集して、熱計算の精度を検証してから実装

### 成功指標
- ⚠️ 予測精度: 要検証
- ✅ 履歴機能: 実装完了

---

## Phase 5: PWA化・最適化 ✅ 完了

**目標**: ネイティブアプリのような体験

### 実装済み機能

#### 5.1 Service Worker実装 ✅
- [x] オフライン動作（全機能）
- [x] Workboxによる自動キャッシング
- [x] @vite-pwa/nuxtモジュール統合

#### 5.2 通知機能 ✅
- [x] バイブレーション（Vibration API）
- [x] 音声通知（Web Audio API）
- [x] ブラウザ通知（Notification API）
- [x] 通知権限管理
- [x] 通知設定の永続化

**実装の変更点**:
- Web Push（バックグラウンド通知）は未実装
- フォアグラウンドでの通知機能のみ実装

#### 5.3 インストールプロンプト ✅
- [x] ホーム画面追加の案内（beforeinstallprompt）
- [x] インストール済み検出
- [x] 「後で」選択の永続化
- [x] PWAマニフェスト設定
- [x] PWAアイコン（SVG）

#### 5.4 パフォーマンス最適化 ⚠️ 一部完了
- [x] タイマー更新: 正確に1秒ごと
- [ ] Lighthouse スコア 90点以上（未計測）
- [ ] 初期ロード時間: 3秒以内（未計測）
- [ ] バッテリー消費の最適化（未検証）

### 成功指標
- ⚠️ PWAインストール率: 要計測
- ⚠️ オフライン利用率: 要計測

---

## Phase 6: 追加機能

**目標**: より便利に、より使いやすく

### オプション機能

#### 6.1 準備リストチェックリスト
- [ ] 保冷剤の準備リマインダー
- [ ] ボウルの準備チェック
- [ ] 湯冷ましの準備チェック

#### 6.2 保冷剤リマインダー
- [ ] 定期的な凍結リマインダー
- [ ] ローカル通知

#### 6.3 音声ガイド（オプション）
- [ ] 各ステップの音声読み上げ
- [ ] 適温到達時の音声通知

#### 6.4 多言語対応
- [ ] 英語
- [ ] 中国語（簡体字）
- [ ] i18n対応

#### 6.5 マルチユーザー対応
- [ ] ユーザープロフィール
- [ ] 赤ちゃんごとの設定
- [ ] クラウド同期（Firebase）

---

## 非機能要件

### パフォーマンス
- 初期ロード時間: 3秒以内
- タイマー更新: 1秒ごと（正確に）
- アニメーション: 60fps維持

### 互換性
- iOS Safari 14+
- Android Chrome 90+
- モダンブラウザ（Chrome, Safari, Edge, Firefox 最新2バージョン）

### アクセシビリティ
- WCAG 2.1 AA準拠
- スクリーンリーダー対応
- キーボード操作可能
- カラーコントラスト比 4.5:1以上

### セキュリティ
- HTTPS必須
- XSS対策
- 機密情報の暗号化（将来の拡張用）

---

## ロードマップ

```
Phase 0: ドキュメント整備（1週間）
  └─ 完了条件: 全ドキュメント作成、規約整備

Phase 1: MVP（3週間）
  └─ 完了条件: 基本タイマー機能、精度±10秒

Phase 2: ビジュアル強化（2週間）
  └─ 完了条件: アニメーション、グラフ実装

Phase 3: 氷水攪拌特化（1週間）
  └─ 完了条件: 揺らしリマインダー実装

Phase 4: 履歴・学習（2週間）
  └─ 完了条件: IndexedDB実装、統計画面

Phase 5: PWA化（1週間）
  └─ 完了条件: オフライン動作、Lighthouse 90+

Phase 6: 追加機能（随時）
  └─ ユーザーフィードバックに基づく拡張
```

---

## リスクと対策

### 技術的リスク
| リスク | 影響 | 対策 |
|--------|------|------|
| 温度予測の精度不足 | 高 | 実測データ収集、補正機能 |
| バイブレーション非対応ブラウザ | 中 | フォールバック（音声通知） |
| バックグラウンドタイマーの制約 | 中 | Web Worker使用 |

### ビジネスリスク
| リスク | 影響 | 対策 |
|--------|------|------|
| ユーザー獲得困難 | 高 | SNSマーケティング、口コミ |
| 競合アプリの登場 | 中 | 独自性（科学的根拠）を強調 |

---

## 🔧 既知の問題・改善項目（Issues）

### Issue #1: 熱計算の精度検証 ⚠️ 重要度: 高

**問題**:
現在の熱計算パラメータ（baseH）が実際の冷却時間と乖離している可能性がある。

**現状**:
- 氷水静置: 計算上 約10分 / 体感 3-5分（約2倍遅い）
- 氷水攪拌: 計算上 約3分 / 体感 未検証
- 水道水静置: 計算上 約15分 / 体感 未検証
- 常温放置: 計算上 約60分 / 体感 未検証

**必要なアクション**:
1. **実測データの収集**
   - 条件: ガラス瓶、140ml、62°C → 38°C
   - 測定項目:
     - 氷水静置の実際の冷却時間
     - 氷水攪拌の実際の冷却時間
     - 水道水静置の実際の冷却時間
     - 常温放置の実際の冷却時間
   - 測定回数: 各方法3回以上

2. **baseHパラメータの調整**
   - 実測データに基づいてbaseHを逆算
   - 各冷却方法のbaseHを修正
   - 体感に合った予測時間になるよう調整

3. **検証**
   - 修正後のパラメータで再度実測
   - 予測時間と実測時間の誤差を確認
   - 目標: 誤差±10秒以内（80%以上）

**実測データ記録テンプレート**:
```
冷却方法: [氷水静置 / 氷水攪拌 / 水道水静置 / 常温放置]
材質: [ガラス / プラスチック / PPSU]
ミルク量: [140ml]
初期温度: [62°C]
目標温度: [38°C]
実測時間: [__分__秒]
メモ: [室温、氷水の温度など]
```

**担当**: 開発者 + ユーザー実測協力
**期限**: 次回リリース前
**ステータス**: 未着手

---

### Issue #2: PWAインストールプロンプトの警告解消 ⚠️ 重要度: 中

**問題**:
開発サーバーのコンソールに以下の警告が表示される:
```
WARN [Vue warn]: Failed to resolve component: PWAInstallPrompt
```

**原因**:
- コンポーネントの自動インポートが正しく機能していない可能性

**必要なアクション**:
1. コンポーネントの明示的なインポート追加
2. Nuxt設定の確認

**担当**: 開発者
**期限**: 低優先度
**ステータス**: 未着手

---

### Issue #3: Lighthouseスコア計測とパフォーマンス最適化 ✅ 完了

**必要なアクション**:
1. ✅ Lighthouseでスコア計測
2. ✅ 90点以上を目指して最適化
3. ✅ 初期ロード時間を3秒以内に

**達成結果**:
- パフォーマンス: **99点**
- アクセシビリティ: **94点**（54点から+40点改善）
- FCP: 1.4秒、LCP: 1.7秒、TBT: 0ms
- 初期ロード: 1.4秒（目標3秒以内を大幅達成）

**実施した改善**:
- HTML lang属性追加（lang="ja"）
- ビューポートのズーム機能有効化（WCAG準拠）
- テキストコントラスト比改善（#666 → #555）

**担当**: 開発者
**完了日**: 2025年10月28日
**ステータス**: ✅ 完了

---

このPRDに基づき、各Phaseを順次実装していきます。
