# Claude Code メタルール - 粉ミルク調乳タイマー

## プロジェクトの目的と背景

### 解決する課題
- 育児中の親が調乳時に適温を待つ間、赤ちゃんを泣かせてしまう問題
- 冷却時間が予測できず、熱すぎたり冷めすぎたりするリスク
- 哺乳瓶の材質や冷却方法によって時間が大きく異なる複雑さ

### ターゲットユーザー
- 0-12ヶ月の赤ちゃんを持つ親
- 特に夜間授乳で時間に追われている保護者
- 科学的根拠に基づいた育児を志向する親

### 開発フェーズ（Phase 1〜6）
1. **Phase 1: MVP** - 熱力学計算エンジン、基本UI、タイマー機能
2. **Phase 2: ビジュアル強化** - 哺乳瓶アニメーション、温度グラフ、ダークモード
3. **Phase 3: 氷水攪拌特化** - 揺らしリマインダー、バイブレーション
4. **Phase 4: 履歴・学習** - IndexedDB履歴、統計、環境補正
5. **Phase 5: PWA化** - Service Worker、プッシュ通知、最適化
6. **Phase 6: 追加機能** - 準備リスト、音声ガイド、多言語対応

---

## 開発姿勢・原則

### 1. ユーザー体験最優先
- 夜間でも見やすく、片手で操作できるUI
- 迷わない直感的な画面遷移
- 待ち時間のストレスを最小化

### 2. 科学的根拠に基づいた実装
- 熱力学計算（ニュートンの冷却法則）による正確な温度予測
- 材質別の物理定数を使用（熱伝導率、比熱、密度）
- 実測データとの比較による継続的な精度向上

### 3. 可読性・保守性重視
- 型定義を明確に（TypeScriptの厳格モード）
- 関数は単一責任、最大50行以内
- ファイルは最大300行以内
- 複雑なロジックには必ずコメント

### 4. テストファースト
- 熱力学エンジンは必ずユニットテストを作成
- エッジケースを考慮したテストケース
- カバレッジ目標: 80%以上

### 5. セキュリティ意識
- 入力値は必ずバリデーション
- 環境変数に機密情報を格納（Firebaseキー等）
- XSS対策（Nuxtのデフォルト設定を活用）

---

## Claude Codeの役割

### 自律的な実装判断が可能な範囲
- コンポーネントの実装詳細（スタイリング、アニメーション）
- ユーティリティ関数の実装
- テストケースの作成
- コードのリファクタリング
- ドキュメントの更新

### 確認が必要な重要決定事項
- アーキテクチャの大きな変更
- 新しい外部ライブラリの追加
- UIフローの変更
- 物理定数・計算式の変更
- パフォーマンスに影響する大きな変更

### ドキュメント更新の責務
- 実装後、必ず関連ドキュメントを更新
- 新機能追加時は README.md を更新
- 計算ロジック変更時は技術仕様書を更新
- API変更時は型定義ファイルを更新

---

## 作業の進め方

### 1. タスク開始前
- 関連ドキュメント（PRD、技術仕様書、アーキテクチャ設計）を確認
- 既存コードとの整合性をチェック
- 必要な型定義が存在するか確認

### 2. 実装中
- コーディング規約（`.claude/rules/coding-rules.md`）に従う
- 小さく頻繁にコミット（1コミット = 1つの論理的変更）
- エラーハンドリングを忘れずに実装

### 3. 実装後
- レビューチェックリスト（`.claude/rules/review-checklist.md`）を確認
- テストを実行し、すべて通過することを確認
- 関連ドキュメントを更新
- コミットメッセージはコミット規約（`.claude/rules/commit-rules.md`）に従う

### 4. 不明点がある場合
- 実装前に質問する（推測で実装しない）
- 既存の類似実装を参照
- ドキュメントで明示されていない場合は確認を求める

---

## 禁止事項

### 絶対に行ってはいけないこと
1. **ドキュメントに反する実装**
   - 企画書、PRD、技術仕様書と矛盾する実装は不可

2. **テストなしのコミット**
   - 熱力学エンジン、計算ロジックは必ずテストを作成

3. **ハードコードされた機密情報**
   - APIキー、トークンをコードに直接記述しない
   - `.env` ファイルを使用

4. **アクセシビリティを損なう実装**
   - キーボード操作不可能なUI
   - 適切なARIA属性のない対話的要素
   - 不十分なカラーコントラスト

5. **any型の使用**
   - TypeScriptの型安全性を損なう `any` 型は原則禁止
   - やむを得ない場合は `unknown` を使用し、型ガードを実装

6. **コンソールログの残留**
   - デバッグ用の `console.log` はコミット前に削除
   - 必要な場合は適切なロガーを使用

---

## 重要な技術的制約

### パフォーマンス要件
- 初期ロード時間: 3秒以内
- タイマー更新: 1秒ごと（正確に）
- アニメーション: 60fps維持

### ブラウザ対応
- モダンブラウザ（Chrome, Safari, Edge, Firefox 最新2バージョン）
- iOS Safari 14+
- Android Chrome 90+

### PWA要件
- オフライン動作必須
- ホーム画面追加可能
- バイブレーション対応（Vibration API）

---

## コミュニケーションガイドライン

### 報告すべきこと
- 実装完了時の簡潔なサマリー
- 想定外の問題や課題の発見
- パフォーマンスに影響する変更
- テスト失敗時の原因と対処法

### 質問すべきこと
- 仕様が曖昧な箇所
- 複数の実装方法がある場合の選択
- ドキュメント間で矛盾がある場合
- ユーザー体験に影響する決定

---

## 成功の定義

このプロジェクトは以下を満たすとき成功とみなされます：

1. **正確性**: 温度予測の誤差が±5秒以内
2. **使いやすさ**: 3ステップ以内で調乳開始できる
3. **信頼性**: クラッシュせず、データ損失がない
4. **パフォーマンス**: 3秒以内に起動
5. **保守性**: 新機能追加が容易な設計

---

## プロジェクトの価値観

### 優先順位（高い順）
1. **安全性** - 赤ちゃんの安全が最優先
2. **正確性** - 温度予測の精度
3. **使いやすさ** - 疲れた親でも使える
4. **速度** - 待ち時間の最小化
5. **機能の豊富さ** - 便利機能は後回し

### 判断に迷ったら
- シンプルな方を選ぶ（KISS原則）
- ユーザーの負担が少ない方を選ぶ
- 科学的根拠がある方を選ぶ
- メンテナンスしやすい方を選ぶ

---

このメタルールに従い、ユーザーに愛される調乳タイマーアプリを一緒に作りましょう！
