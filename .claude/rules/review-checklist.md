# コードレビューチェックリスト - 粉ミルク調乳タイマー

コミット前に必ずこのチェックリストを確認してください。

---

## 1. 機能要件チェック

### 要件充足
- [ ] PRD（企画書）の要件を満たしているか
- [ ] 技術仕様書の設計通りに実装されているか
- [ ] ユーザーストーリーが完了しているか

### エッジケース
- [ ] 最小値・最大値での動作を確認したか
  - ミルク量: 100ml〜240ml
  - 目標温度: 36°C〜40°C
  - 室温: 15°C〜30°C
- [ ] 入力値が不正な場合の処理があるか
- [ ] データが存在しない場合の処理があるか
- [ ] ネットワークエラー時の処理があるか（将来の拡張用）

### エラーハンドリング
- [ ] try-catch で適切にエラーを捕捉しているか
- [ ] エラーメッセージはユーザーフレンドリーか
- [ ] エラー発生時にアプリがクラッシュしないか
- [ ] console.error でエラーログを出力しているか

---

## 2. コード品質チェック

### 命名規則
- [ ] 変数名・関数名は明確で一貫性があるか
- [ ] boolean変数は `is`, `has`, `should` で始まるか
- [ ] 定数は `UPPER_SNAKE_CASE` か
- [ ] コンポーネント名は PascalCase か
- [ ] Composable名は `use` プレフィックスがあるか

### コードの重複
- [ ] 重複コードはないか（DRY原則）
- [ ] 共通ロジックはユーティリティ関数化されているか
- [ ] 似た処理は共通化されているか

### 関数設計
- [ ] 1つの関数は1つの責務のみを持つか
- [ ] 関数は50行以内か
- [ ] 引数は4つ以内か（多い場合はオブジェクトにまとめる）
- [ ] 関数名から処理内容が推測できるか

### マジックナンバー
- [ ] ハードコードされた数値はないか
- [ ] 物理定数は適切に定数化されているか
  ```typescript
  // ❌ Bad
  if (temp > 100) return;

  // ✅ Good
  const MAX_SAFE_TEMPERATURE = 100;
  if (temp > MAX_SAFE_TEMPERATURE) return;
  ```

---

## 3. TypeScript チェック

### 型安全性
- [ ] `any` 型を使用していないか
- [ ] すべての関数に引数・戻り値の型注釈があるか
- [ ] `unknown` 使用時は型ガードがあるか
- [ ] オプショナルプロパティは `?` で明示されているか

### 型エラー
- [ ] `pnpm nuxi typecheck` でエラーがないか
- [ ] VSCodeで型エラーが表示されていないか
- [ ] 型アサーション（`as`）を乱用していないか

### 型定義
- [ ] 新しい型は `types/` ディレクトリに定義されているか
- [ ] インターフェースとタイプを適切に使い分けているか
- [ ] ユニオン型は網羅的にチェックされているか

```typescript
// ✅ Good: 網羅的チェック
type CoolingMethod = 'ice_stir' | 'ice_still' | 'running_water';

const getMethodName = (method: CoolingMethod): string => {
  switch (method) {
    case 'ice_stir': return '氷水攪拌';
    case 'ice_still': return '氷水静置';
    case 'running_water': return '流水冷却';
    default:
      const _exhaustive: never = method;
      throw new Error(`Unknown method: ${_exhaustive}`);
  }
};
```

---

## 4. パフォーマンスチェック

### 再レンダリング
- [ ] 不要な再レンダリングはないか
- [ ] computed プロパティで計算結果をキャッシュしているか
- [ ] watch の依存配列は適切か
- [ ] memo化が必要な重い処理はないか

### データ処理
- [ ] 大きなデータの処理は最適化されているか
- [ ] ループ内で不要な処理をしていないか
- [ ] 配列操作は効率的か（O(n²)になっていないか）

### メモリリーク
- [ ] `setInterval`/`setTimeout` は適切にクリアされているか
- [ ] イベントリスナーは適切に削除されているか
- [ ] Composable内のリソースはクリーンアップされているか

```vue
<!-- ✅ Good: クリーンアップあり -->
<script setup lang="ts">
const intervalId = ref<number | null>(null);

onMounted(() => {
  intervalId.value = window.setInterval(() => {
    // ...
  }, 1000);
});

onUnmounted(() => {
  if (intervalId.value !== null) {
    clearInterval(intervalId.value);
  }
});
</script>
```

---

## 5. アクセシビリティチェック

### ARIA属性
- [ ] 適切な `role` 属性があるか
- [ ] `aria-label` で説明が提供されているか
- [ ] フォーカス可能な要素に `aria-describedby` があるか

### キーボード操作
- [ ] すべてのボタンがキーボードで操作可能か
- [ ] Tabキーでフォーカス移動できるか
- [ ] Enterキー/Spaceキーでボタンが押せるか
- [ ] Escキーでモーダルが閉じるか

### カラーコントラスト
- [ ] テキストと背景のコントラスト比は4.5:1以上か
- [ ] 色だけで情報を伝えていないか
- [ ] ダークモードでも見やすいか

```vue
<!-- ✅ Good: アクセシビリティ対応 -->
<button
  type="button"
  aria-label="タイマーを一時停止"
  @click="handlePause"
>
  一時停止
</button>
```

---

## 6. セキュリティチェック

### 入力バリデーション
- [ ] ユーザー入力は適切にバリデーションされているか
- [ ] 数値入力は範囲チェックされているか
- [ ] 文字列入力はサニタイズされているか

### XSS対策
- [ ] `v-html` を使用していないか（必要な場合のみ）
- [ ] ユーザー入力をそのまま表示していないか
- [ ] URLパラメータは適切にエスケープされているか

### 機密情報
- [ ] APIキー・トークンがハードコードされていないか
- [ ] 環境変数（`.env`）を使用しているか
- [ ] `.env` ファイルは `.gitignore` に含まれているか
- [ ] 機密情報がconsole.logに出力されていないか

```typescript
// ❌ Bad: APIキーをハードコード
const apiKey = 'AIzaSyABCDEFG...';

// ✅ Good: 環境変数を使用
const config = useRuntimeConfig();
const apiKey = config.public.firebase.apiKey;
```

---

## 7. テストチェック

### ユニットテスト
- [ ] 主要な関数にテストがあるか
- [ ] 熱力学計算のテストがあるか
- [ ] エッジケースのテストがあるか
- [ ] すべてのテストが通るか（`pnpm test`）

### テストカバレッジ
- [ ] カバレッジは80%以上か
- [ ] 重要な分岐はすべてテストされているか
- [ ] エラーパスもテストされているか

### E2Eテスト（将来）
- [ ] 画面遷移のテストがあるか
- [ ] ユーザーフローのテストがあるか

```typescript
// ✅ Good: テスト例
import { describe, it, expect } from 'vitest';
import { calculateNewtonCooling } from '~/utils/thermal/calculator';

describe('calculateNewtonCooling', () => {
  it('正しい温度を計算する', () => {
    const result = calculateNewtonCooling(46.6, 0.88, 2, 0.2401);
    expect(result).toBeCloseTo(38, 1);
  });

  it('経過時間0では初期温度を返す', () => {
    const result = calculateNewtonCooling(46.6, 0, 2, 0.2401);
    expect(result).toBe(46.6);
  });
});
```

---

## 8. ドキュメントチェック

### コードコメント
- [ ] 複雑なロジックにコメントがあるか
- [ ] 物理定数・計算式に説明があるか
- [ ] JSDocが記述されているか（公開関数）
- [ ] TODO/FIXMEコメントは適切か

### ドキュメント更新
- [ ] README.md を更新したか（新機能追加時）
- [ ] 技術仕様書を更新したか（アーキテクチャ変更時）
- [ ] APIドキュメントを更新したか（型定義変更時）
- [ ] コミットメッセージは規約に従っているか

---

## 9. UIチェック（コンポーネント実装時）

### レスポンシブ
- [ ] モバイル画面で正しく表示されるか
- [ ] タブレット画面で正しく表示されるか
- [ ] 横向き表示でも問題ないか

### ユーザー体験
- [ ] 片手で操作できるか
- [ ] タップ領域は十分大きいか（最低44x44px）
- [ ] ローディング状態が表示されるか
- [ ] エラー状態が適切に表示されるか

### アニメーション
- [ ] アニメーションは60fps維持できるか
- [ ] `prefers-reduced-motion` に対応しているか
- [ ] アニメーションは邪魔にならないか

---

## 10. ビルド・デプロイチェック

### ビルド
- [ ] `pnpm build` が成功するか
- [ ] ビルドサイズは適切か
- [ ] 不要なライブラリが含まれていないか

### Lint
- [ ] `pnpm lint` でエラーがないか
- [ ] ESLint警告を解消したか
- [ ] Prettier でフォーマット済みか

### Git
- [ ] コミットメッセージは規約に従っているか
- [ ] 不要なファイルがコミットされていないか
- [ ] `.gitignore` が適切に設定されているか

---

## チェックリスト使用例

```markdown
## レビューチェックリスト

### 機能要件
- [x] PRDの要件を満たしている
- [x] エッジケースを考慮している
- [x] エラーハンドリングが適切

### コード品質
- [x] 命名は明確で一貫性がある
- [x] 重複コードはない
- [x] 関数は単一責任

### TypeScript
- [x] any型を使用していない
- [x] 型エラーがない
- [x] 適切な型定義

### テスト
- [x] ユニットテストあり
- [x] カバレッジ85%
- [x] すべてのテストが通る

### ドキュメント
- [x] コメント追加済み
- [x] README更新済み
```

---

このチェックリストを活用して、高品質なコードをコミットしましょう！
